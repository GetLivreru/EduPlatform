# üöÄ Redis Integration Guide

## üìã –û–±–∑–æ—Ä

Redis –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à—É –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è:
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üéØ –ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ Redis

### üî• –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø)

#### 1. **–°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** 
```redis
session:{user_id}
TTL: 30 –º–∏–Ω—É—Ç
–î–∞–Ω–Ω—ã–µ: {id, name, login, role, quiz_points, last_activity}
```

#### 2. **–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
```redis
user:{user_id}
TTL: 30 –º–∏–Ω—É—Ç  
–î–∞–Ω–Ω—ã–µ: {id, name, login, role, quiz_points, created_at}
```

#### 3. **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–≤–∏–∑–æ–≤**
```redis
quizzes:all
TTL: 10 –º–∏–Ω—É—Ç
–î–∞–Ω–Ω—ã–µ: [{id, title, category, difficulty, time_limit}...]
```

#### 4. **–î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–≤–∏–∑–æ–≤**
```redis
quiz:{quiz_id}
TTL: 1 —á–∞—Å
–î–∞–Ω–Ω—ã–µ: {title, description, questions, category, difficulty...}
```

### üìä –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)

#### 5. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```redis
user_results:{user_id}
TTL: 2 —á–∞—Å–∞
–î–∞–Ω–Ω—ã–µ: [{quiz_id, score, completed_at}...]
```

#### 6. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è**
```redis
recommendations:{user_id}
TTL: 6 —á–∞—Å–æ–≤
–î–∞–Ω–Ω—ã–µ: {weak_areas, resources, schedule...}
```

#### 7. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è**
```redis
learning_path:{user_id}
TTL: 24 —á–∞—Å–∞
–î–∞–Ω–Ω—ã–µ: {subject, level, content, duration...}
```

#### 8. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–∏–∑–æ–≤**
```redis
quiz_stats:{quiz_id}
TTL: 1 —á–∞—Å
–î–∞–Ω–Ω—ã–µ: {total_attempts, avg_score, completion_rate}
```

#### 9. **–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
```redis
leaderboard:top
TTL: 5 –º–∏–Ω—É—Ç
–î–∞–Ω–Ω—ã–µ: [{user_id, name, points}...]
```

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
backend/
‚îú‚îÄ‚îÄ redis_cache.py          # üÜï –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å Redis
‚îú‚îÄ‚îÄ main.py                 # ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îú‚îÄ‚îÄ quizzes.py         # ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–≤–∏–∑–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ requirements.txt        # ‚úÖ Redis –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ env_example.txt        # ‚úÖ –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã Redis

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
```python
from redis_cache import cache

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
await cache.set("key", data, ttl=3600)

# –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ  
data = await cache.get("key")

# –£–¥–∞–ª–∏—Ç—å –∫–ª—é—á
await cache.delete("key")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
exists = await cache.exists("key")
```

#### **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã**
```python
# –°–µ—Å—Å–∏–∏
await cache.save_session(user_id, session_data)
session = await cache.get_session(user_id)

# –ö–≤–∏–∑—ã
await cache.cache_quiz(quiz_id, quiz_data)
quiz = await cache.get_quiz(quiz_id)

# –ü—Ä–æ—Ñ–∏–ª–∏
await cache.cache_user_profile(user_id, profile_data)
profile = await cache.get_user_profile(user_id)

# –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
await cache.invalidate_user_cache(user_id)
await cache.invalidate_quiz_cache(quiz_id)
```

## üê≥ Docker Setup

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π docker-compose.yml
```yaml
services:
  # Redis —Å–µ—Ä–≤–∏—Å
  redis:
    image: redis:7.2-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    networks:
      - app-network

  # Backend —Å Redis
  backend:
    build: ./backend
    environment:
      - REDIS_URL=redis://redis:6379
      - MONGODB_URL=mongodb://admin:password123@mongodb:27017/LearnApp?authSource=admin
    depends_on:
      - mongodb
      - redis

volumes:
  redis_data:    # üÜï –¢–æ–º –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Redis
```

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis (Ubuntu/Debian)
sudo apt update
sudo apt install redis-server

# –ó–∞–ø—É—Å–∫ Redis
sudo systemctl start redis-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
redis-cli ping
# –û—Ç–≤–µ—Ç: PONG
```

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python
cd backend
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env_example.txt .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ backend
uvicorn main:app --reload
```

### 2. Docker –∑–∞–ø—É—Å–∫
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Redis
docker logs redis

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis CLI
docker exec -it redis redis-cli
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### Redis CLI –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
redis-cli

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π
KEYS *

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–ª—é—á–µ–π –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
KEYS session:*
KEYS quiz:*
KEYS user:*

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
GET session:507f1f77bcf86cd799439011

# –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL
TTL quiz:507f1f77bcf86cd799439011

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Redis
INFO memory
INFO stats

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
FLUSHALL
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```python
# –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤ –≤ –∫–æ–¥–µ:
print("üì¶ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –ø–æ–ª—É—á–µ–Ω –∏–∑ –∫—ç—à–∞")
print("üíæ –°–ø–∏—Å–æ–∫ –∫–≤–∏–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫—ç—à")
print("üóëÔ∏è –ö—ç—à –∫–≤–∏–∑–∞ {quiz_id} –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–ö–≤–∏–∑—ã**: 80-90% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞
- **–ü—Ä–æ—Ñ–∏–ª–∏**: 70-85% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞  
- **–°–µ—Å—Å–∏–∏**: 95% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞
- **–û–±—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å**: —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 2-5x

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```python
# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–≤–∏–∑–∞
await cache.delete("quizzes:all")

# –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–≤–∏–∑–∞
await cache.invalidate_quiz_cache(quiz_id)

# –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
await cache.invalidate_user_cache(user_id)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ TTL
```python
# –ë—ã—Å—Ç—Ä–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ
SESSION_TTL = 1800      # 30 –º–∏–Ω—É—Ç
PROFILE_TTL = 1800      # 30 –º–∏–Ω—É—Ç
LEADERBOARD_TTL = 300   # 5 –º–∏–Ω—É—Ç

# –°—Ä–µ–¥–Ω–µ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ  
QUIZ_LIST_TTL = 600     # 10 –º–∏–Ω—É—Ç
QUIZ_TTL = 3600         # 1 —á–∞—Å
USER_RESULTS_TTL = 7200 # 2 —á–∞—Å–∞

# –ú–µ–¥–ª–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ
RECOMMENDATIONS_TTL = 21600  # 6 —á–∞—Å–æ–≤
LEARNING_PATH_TTL = 86400    # 24 —á–∞—Å–∞
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis
```conf
# redis.conf —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
maxmemory 256mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10  
save 60 10000
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏** –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TTL** –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** Redis –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–∞** –∫ Redis

### –ü—Ä–æ–¥–∞–∫—à–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
# –í–∫–ª—é—á–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
requirepass your-strong-redis-password

# –û—Ç–∫–ª—é—á–∏—Ç—å –æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""
```

## üéØ –î–ª—è –¥–∏–ø–ª–æ–º–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
1. **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MongoDB** –Ω–∞ 60-80%
2. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞ API** –≤ 2-5 —Ä–∞–∑
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –¥–ª—è –±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –∫—ç—à —Å–µ—Å—Å–∏–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: Redis (–±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø) + MongoDB (–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- **Graceful degradation**: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Redis
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—ç—à–∞

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω—ã–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫ –¥–∏–ø–ª–æ–º–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É! üöÄ 